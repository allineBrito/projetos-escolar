<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hist√≥ricas Decoloniais</title>
<style>


.main-title {
  font-size: 28px;
  font-weight: bold;
  background: linear-gradient(90deg, #c59f9f, #f3b735, #17c0e6, #0edba5);
  color: #4b2e2e; /* marrom escuro */
  white-space: nowrap;
  overflow: hidden;
  border-right: 3px solid #a0522d; /* cursor marrom */
  width: 0;
  animation: typing 4s steps(50, end) forwards,
             blink 0.8s step-end infinite;
}

/* Digita√ß√£o */
@keyframes typing {
  from { width: 0; }
  to { width: 100%; }
}

/* Cursor piscando */
@keyframes blink {
  50% { border-color: transparent; }
}

.subtitle {
  text-align: center;
  font-size: 1.2rem;
  color: linear-gradient(90deg, #c59f9f, #f3b735, #17c0e6, #0edba5);
  max-width: 800px;
  margin: 0 auto 1rem auto;
  line-height: 1.5;
}

  :root {
  --bg:#fbf6f6; 
  --card:#d8d0d0; /* cor do fundo dos quadros - marrom claro (wheat) */
  --fg:#0b1220; 
  --muted:#556;
  --accent:#a0522d; /* j√° trocado para marrom */
}

 body{
  font-family: Arial, Helvetica, sans-serif;
  margin: 0;
  padding: 1rem;
  background: #dabbac;  /* marrom claro (tom tipo "tan") */
  color: var(--fg);
}

  h1,h2{ text-align:center; }
  .card{
    background:var(--card); border-radius:12px; padding:1rem;
    margin:1rem auto; max-width:900px; box-shadow:0 2px 8px rgba(0,0,0,0.1);
  }
  select,button{
    padding:0.5rem; margin:0.25rem 0; border-radius:6px; border:1px solid #6e6b6b;
    font-size:1rem;
  }
  button {
  background-color: #a0522d;  /* cor de fundo do bot√£o */
  color: #fff;               /* cor do texto */
  border: none;
  padding: 10px 16px;
  border-radius: 6px;
  cursor: pointer;
}

button:hover {
  background-color: #8b4513; /* cor no hover */
}

  button:hover{ opacity:0.9; }
  button:disabled{
    background:#ccc; color:#666; cursor:not-allowed;
  }
  img{ max-width:100%; border-radius:8px; margin:0.5rem 0; }
  .audio-btn{ margin-right:0.5rem; }
  .compare-grid{
    display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
    gap:1rem; margin-top:1rem;
  }

  /* Estilos para a grava√ß√£o - ADICIONADOS */
  .recording-status {
    margin: 10px 0;
    padding: 10px;
    border-radius: 6px;
    text-align: center;
    font-weight: bold;
  }
  .recording-active {
    background-color: #ffebee;
    color: #c62828;
    border: 1px solid #c62828;
  }
  .recording-saved {
    background-color: #e8f5e8;
    color: #2e7d32;
    border: 1px solid #2e7d32;
  }
</style>
</head>
<body>
<h1 class="main-title">Hist√≥rias em Vozes: Um Olhar Decolonial</h1>
<p class="subtitle">Agora vamos comparar as narrativas historicas, podemos dizer que a historia dos livros sempre tem raz√£o em rela√ß√£o aos eventos histr√≥ricos?</p>



<div class="card" aria-label="Sele√ß√£o e narrativa">
  <fieldset>
    <legend>Selecione evento e narrador</legend>
    <label for="eventoSelect">Evento:</label>
    <select id="eventoSelect" aria-label="Selecionar evento"></select><br>
    <label for="narradorSelect">Narrador:</label>
    <select id="narradorSelect" aria-label="Selecionar narrador"></select><br>
    <button id="showNarrative">Mostrar narrativa</button>
    <button id="resetView">Limpar</button>
    <button id="compareBtn">Comparar narrativas</button>
  </fieldset>

  <div id="narrativeArea">
    <h2>Narrativa</h2>
    <div id="narrativeText">Selecione um evento e um narrador, depois clique em "Mostrar narrativa".</div>
    <div id="eventImageContainer"></div>
    <div id="audioControls">
      <button id="playAudio" class="audio-btn">‚ñ∂Ô∏è Reproduzir √Åudio</button>
      <button id="stopAudio" class="audio-btn">‚èπÔ∏è Parar √Åudio</button>
      <button id="playAD" class="audio-btn" disabled>‚ôø Audiodescri√ß√£o</button>
    </div>
  </div>

  <div id="comparisonArea"></div>
</div>

<div class="card">
  <h2>Conte-nos seu ponto de vista da hist√≥ria</h2>
  <p>Selecione um Evento. <strong>Ao parar a grava√ß√£o, o √°udio ser√° salvo automaticamente</strong> para o narrador <strong>"Estudante"</strong> neste evento.</p>
  
  <!-- ADICIONADO: Status da grava√ß√£o -->
  <div id="recordingStatus" class="recording-status"></div>
  
  <button id="recStart">üî¥ Iniciar Grava√ß√£o</button>
  <button id="recStop" disabled>‚èπÔ∏è Parar e Salvar</button>
  <button id="recPlay" disabled>‚ñ∂Ô∏è Reproduzir Grava√ß√£o</button>
  <!-- ADICIONADO: Bot√£o para excluir grava√ß√£o -->
  <button id="recDelete" disabled>üóëÔ∏è Excluir Grava√ß√£o</button>
</div>


<script>
// DICA: Substitua os valores 'audio/...' pelas URLs ou caminhos reais dos seus arquivos

// DICA: Substitua os valores 'audio/...' pelas URLs ou caminhos reais dos seus arquivos
  const audioMapping = {
    "Coloniza√ß√£o do Brasil (s√©culo XVI e XVII)": {
      "Portugu√™s": "audio/Text-to-Speech.mp3", 
      "Ind√≠gena": "audio/indi.mp3",
      "Africano escravizado": "audio/neg.mp3",
    },
    "Per√≠odo das Revoltas Regenciais (1831 ‚Äì 1840)": {
      "Cronista portugu√™s": "audio/revolta_port.mp3",
      "Ind√≠gena": "audio/revolta_indi.mp3",
      "Africano escravizado": "audio/revolta_afri.mp3",
    },
    "Guerra de Canudos (1893 ‚Äì 1897)": {
      "Cronista portugu√™s": "audio/revolta_port.mp3",
      "Ind√≠gena": "audio/revolta_indi.mp3",
      "Africano escravizado": "audio/revolta_afri.mp3",
    }
  };

// --- Imagens de Perfil do Narrador (Fallback ou uso no modo Compara√ß√£o) ---
const imageMapping = {
  "Cronista portugu√™s": "https://exemplo.com/perfil_cronista.jpg", 
  "Ind√≠gena": "https://exemplo.com/perfil_indigena.png",
  "Africano escravizado": "https://exemplo.com/perfil_africano.png",
  "Mulher negra": "https://exemplo.com/perfil_mulher_negra.jpg",
  "Estudante": "https://exemplo.com/perfil_estudante.png"
};

// --- Imagens espec√≠ficas por Evento e Narrador ---
const eventImageMapping = {
  "Coloniza√ß√£o do Brasil (s√©culo XVI e XVII)": {
    "Cronista portugu√™s": "https://s1.static.brasilescola.uol.com.br/be/2024/09/revolucao-pernambucana.jpg",
    "Ind√≠gena": "https://www.omunicipio.jor.br/wordpress/wp-content/uploads/2024/04/01-8.jpg",
    "Africano escravizado": "https://ensinarhistoria.com.br/s21/wp-content/uploads/2015/06/07_Casa-de-negros_Rugendas.jpg",
  },
  "Per√≠odo das Revoltas Regenciais (1831 ‚Äì 1840)": {
    "Cronista portugu√™s": "https://exemplo.com/males_gravura_repressao.jpg",
    "Ind√≠gena": "https://www.pstu.org.br/wp-content/uploads/2019/01/cabanagem-capa-1122096.png",
    "Africano escravizado": "https://static.preparaenem.com/2023/11/pintura-retratando-escravo-sendo-punido-em-um-pelourinho-em-alusao-a-revolta-dos-males.jpg",
  },
  "Guerra de Canudos (1893 ‚Äì 1897)": {
    "Cronista portugu√™s": "https://biografiaresumida.com.br/wp-content/webp-express/webp-images/uploads/2019/01/Guerra-de-Canudos.jpg.webp",
    "Ind√≠gena": "https://bahia.ws/wp-content/uploads/2012/11/guerra_dos_canudos.jpg",
    "Africano escravizado": "https://static.wixstatic.com/media/02a26c_fac557e40b9840ad80c9419333af4344~mv2.jpg/v1/fill/w_568,h_320,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/02a26c_fac557e40b9840ad80c9419333af4344~mv2.jpg",
  }
};

// --- Narrativas por Evento (Mantido) ---
const data = {
  "Coloniza√ß√£o do Brasil (s√©culo XVI e XVII)":{
    narrativas:{
      "Cronista portugu√™s":"Escutai, fi√©is s√∫ditos do Reino de Portugal! O que contemplamos no Brasil n√£o √© apenas terra distante; √© um novo e glorioso alicerce do nosso Imp√©rio. Desde a chegada de Cabral, cumprimos o dever sagrado de tomar posse e levar a luz da civiliza√ß√£o a estas vastid√µes do Novo Mundo.Nosso prop√≥sito √© a riqueza ‚Äî clara e inabal√°vel. Fizemos do litoral nordestino o maior engenho a√ßucareiro do mundo, produzindo o ‚ÄòOuro Branco‚Äô que transborda nos mercados da Europa e fortalece os cofres da Coroa. O sistema colonial erguido por nossas m√£os √© s√≥lido e disciplinado: a monocultura, o Pacto Colonial, a ordem que assegura que toda abund√¢ncia ‚Äî do a√ß√∫car √† madeira, dos animais ao tabaco ‚Äî reverta em benef√≠cio exclusivo de Lisboa. Aqui n√£o h√° desperd√≠cio; h√° apenas a for√ßa de uma economia disciplinada, moldada para a gl√≥ria do Reino",
      "Ind√≠gena":"Quando o ‚Äòpovo do mar‚Äô chegou, nossa vida mudou para sempre. Vieram como invasores, n√£o como amigos. No in√≠cio, houve curiosidade: trocamos pau-brasil por ferro. Mas logo vimos a verdade ‚Äî queriam nossa terra e nossos corpos. Para eles, a floresta era mercadoria; para n√≥s, era m√£e, ca√ßa e mem√≥ria dos ancestrais. Tentaram nos escravizar em planta√ß√µes erguidas sobre nossas terras. Chamaram-nos de ‚Äò√≠ndios cativos‚Äô, venderam-nos como animais. A guerra deles era estranha: o escambo criava depend√™ncia, e suas doen√ßas ‚Äî var√≠ola, sarampo ‚Äî dizimavam aldeias inteiras, mais mortais que suas espadas. Resistimos. Lutamos por nossos chefes, por nossos, por nossa liberdade. Nossa terra, nosso povo, nossa cultura foram atacados. Mas n√£o desaparecemos. Nossa mem√≥ria, nossas l√≠nguas e nossa luta permanecem. Para n√≥s, a hist√≥ria do Brasil √© a hist√≥ria de uma invas√£o cont√≠nua que ainda combatemos ",
      "Africano escravizado":"Nossa hist√≥ria n√£o come√ßou no Brasil, mas nas terras que chamam de √Åfrica. Fomos arrancados de nossos reinos √† for√ßa. O que os portugueses chamam de tr√°fico, n√≥s chamamos de Grande Roubo: a captura brutal, a travessia nos tumbeiros, onde a fome e a doen√ßa matavam muitos antes mesmo de chegar aqui. Neste ch√£o, n√£o √©ramos vistos como pessoas, mas como ‚Äòpe√ßas‚Äô. Nosso corpo pertencia ao senhor, nosso tempo era medido pelo sol e pelo chicote. Nas planta√ß√µes e engenhos, o trabalho era incessante, a viol√™ncia di√°ria. Nossa vida valia menos que o a√ß√∫car que produz√≠amos. Mas nunca aceitamos o cativeiro. Nossa alma permaneceu livre. Resistimos em todos os lugares, constru√≠mos quilombos, guardamos nossas culturas. O Brasil dos s√©culos XVI e XVII foi genoc√≠dio e escravid√£o que enriqueceram Portugal ‚Äî mas tamb√©m foi a hist√≥ria de uma luta implac√°vel pela dignidade, que jamais foi derrotada.",
      "Estudante":""
    },
    ad:{
      "Cronista portugu√™s":"Praia com embarca√ß√µes portuguesas chegando, soldados descendo armados.",
      "Ind√≠gena":"Praia vista pelos povos origin√°rios, com barcos imensos se aproximando.",
      "Africano escravizado":"Representa√ß√£o simb√≥lica do in√≠cio do tr√°fico de africanos escravizados.",
      "Estudante":""
    }
  },
  "Per√≠odo das Revoltas Regenciais (1831 ‚Äì 1840)":{
    narrativas:{
      "Cronista portugu√™s":"A ordem do Imp√©rio est√° sob ataque, e a unidade nacional corre grave perigo! A aus√™ncia de um imperador adulto tem encorajado fac√ß√µes insubordinadas e a pior esc√≥ria da sociedade. Somos os herdeiros leg√≠timos e os guardi√µes da civiliza√ß√£o que Portugal trouxe a estas terras. O nosso dever √© manter o Brasil coeso, pr√≥spero e, acima de tudo, hier√°rquico. As revoltas que vemos no Par√°, na Bahia e no Maranh√£o n√£o s√£o por 'justi√ßa' ou 'liberdade', mas sim por anarquia e fanatismo. S√£o bandos de desocupados, √≠ndios, caboclos e africanos que, em sua ignor√¢ncia, amea√ßam a estrutura que sustenta a nossa economia. No Maranh√£o, s√£o os 'balaios'; na Bahia, os negros mu√ßulmanos que conspiram para destruir a nossa f√© e a nossa propriedade! Nossas tropas agir√£o com a for√ßa necess√°ria para esmagar estas sedi√ß√µes, restaurar a paz e provar ao mundo que o Brasil √© uma na√ß√£o que pode se governar. Quem amea√ßar a ordem, amea√ßa o pr√≥prio Imp√©rio, e ser√° tratado como traidor da p√°tria.",
      "Ind√≠gena":"Chamam-nos ‚Äòcabanos‚Äô, ‚Äòselvagens‚Äô, ‚Äòdesordeiros‚Äô, mas somos os verdadeiros donos desta floresta e destas √°guas. Nossos antepassados trabalharam esta terra; vimos os bar√µes do a√ß√∫car e do gado roubarem-na enquanto se vestem de seda nas cidades. Sob as leis dos portugueses e dos Regentes, continuamos sendo os √∫ltimos.Quando D. Pedro I partiu, acreditamos que ser√≠amos ouvidos ‚Äî mas nada mudou para quem vive √† beira do rio e na pobreza. Persistem a escravid√£o, a humilha√ß√£o e o roubo do nosso sustento. Pegamos em armas por fome e por justi√ßa: queremos governar o Par√°, queremos que a terra perten√ßa a quem a cultiva e que os tiranos que se alimentam do nosso suor sejam expulsos. Derramamos sangue porque lutamos para n√£o morrer de mis√©ria; a for√ßa da floresta est√° conosco, e nosso clamor por um governo justo √© mais forte que as balas do Imp√©rio.",
      "Africano escravizado":"O que nos trouxeram foi a escravid√£o, mas n√£o conseguiram escravizar a nossa f√© e o nosso conhecimento. Vimos a fraqueza do governo quando o Imperador era apenas um menino. Sab√≠amos que era o momento de agir. Em toda a Bahia, nos engenhos e nas ruas de Salvador, est√°vamos prontos. N√≥s, os Mal√™s, conhecemos a disciplina e a Lei de Al√°. O nosso plano era claro: libertar todos os irm√£os negros, matar os senhores brancos e os mulatos que nos oprimiam, e estabelecer uma terra de justi√ßa e igualdade, guiada pela nossa religi√£o. N√£o lut√°vamos apenas pela liberdade do corpo; lut√°vamos pela liberdade da alma e pela nossa dignidade. Fomos tra√≠dos, sim, e a repress√£o foi terr√≠vel. Os Regentes nos ca√ßaram como animais, nos prenderam, nos chicotearam e nos executaram na pra√ßa p√∫blica. Mas o nosso levante provou o nosso poder: escravo n√£o √© inofensivo. Mostramos que, mesmo nas senzalas e nas cidades, o esp√≠rito africano se organiza, conspira e tem a for√ßa de abalar o poder dos brancos. Nossas a√ß√µes ecoaram por toda a col√¥nia, dando esperan√ßa a cada homem e mulher que sonha em quebrar suas correntes.",
      "Estudante":""
    },
    ad:{
      "Cronista portugu√™s":"Gravura com repress√£o portuguesa ao levante dos Mal√™s.",
      "Ind√≠gena":"Vis√£o ind√≠gena da resist√™ncia negra na cidade de Salvador.",
      "Africano escravizado":"Imagem de africanos mu√ßulmanos escravizados vestidos de branco em rebeli√£o.",
      "Estudante":""
    }
  },
  "Guerra de Canudos (1893 ‚Äì 1897)":{
    narrativas:{
      "Cronista portugu√™s":"O que presenciamos em Canudos n√£o √© um levante popular, mas uma revolta de fan√°ticos contra a jovem Rep√∫blica. Ant√¥nio Conselheiro, esse beato lun√°tico e perigoso, ilude as massas de miser√°veis, prometendo um retorno √† Monarquia e um fim aos impostos e ao casamento civil, pilares da nossa nova Ordem e Progresso. Desde a Proclama√ß√£o da Rep√∫blica, o sert√£o tem sido um foco de desobedi√™ncia e supersti√ß√£o, e Canudos transformou-se em um foco de resist√™ncia √† civiliza√ß√£o. Eles acumularam armas e desafiaram a autoridade do Ex√©rcito Nacional. Nossas tropas, representando a lei e a raz√£o, tiveram que marchar sobre o arraial para extirpar este c√¢ncer social. A batalha foi longa e custou o sangue de muitos bravos. Mas a vit√≥ria da Rep√∫blica √© inquestion√°vel: o local foi varrido, e a amea√ßa de um fanatismo pol√≠tico-religioso foi eliminada pela for√ßa da raz√£o e do Estado. A hist√≥ria registrar√° a firmeza com que o Brasil moderno reagiu a essa praga da ignor√¢ncia.",
      "Ind√≠gena":"Chamaram nossa vida de 'fanatismo' e nosso arraial de 'covil de bandidos', mas Canudos era o nosso ref√∫gio. O Conselheiro n√£o era um rei, era um guia, um santo que nos deu esperan√ßa quando o mundo dos 'doutores' s√≥ nos dava fome e imposto. A seca castigava, e a Rep√∫blica, que prometeu liberdade, s√≥ trouxe papeladas, novos fiscais e mais mis√©ria. Quem era pobre e sem-terra podia construir uma vida no arraial: n√£o havia pagamento, apenas trabalho coletivo e f√©. Eles nos atacaram n√£o por sermos contra a lei deles, mas por ousarmos ser independentes e felizes na nossa pobreza. Nossas mulheres e nossos filhos sofreram o terror dos canh√µes e fuzis. Lutamos at√© o √∫ltimo homem, n√£o por um rei no Rio de Janeiro, mas pelo nosso ch√£o, pela nossa f√© e para n√£o ter de morrer de novo nas m√£os dos coron√©is e do governo sem cora√ß√£o. Fomos massacrados, mas o que fizemos em Canudos foi uma luta pela dignidade do sertanejo.",
      "Africano escravizado":"Naquele tempo de mudan√ßa de lei, a vida no sert√£o era dura para o liberto. A aboli√ß√£o veio, mas n√£o veio a terra nem o trabalho digno. Muitos de n√≥s, rec√©m-sa√≠dos da escravid√£o, ou filhos de escravizados, fomos para Canudos porque o Conselheiro n√£o olhava a cor nem a antiga condi√ß√£o. L√°, √©ramos todos irm√£os, trabalhando a terra juntos. Era um lugar onde a 'Lei do Branco' n√£o mandava e onde a nossa f√©, misturada com as cren√ßas do Conselheiro, nos protegia. Os fazendeiros e o Ex√©rcito odiavam Canudos porque ali morava o medo de que o pobre tivesse poder. Eles tinham medo de ver o negro, o √≠ndio e o sertanejo juntos, rezando e construindo uma vida sem a dor do chicote. A guerra foi deles, mas a coragem foi nossa. Morremos defendendo a ideia de que o pobre tem direito a um peda√ßo de terra e a viver em paz, livre do chicote do coronel e da fome que o novo governo n√£o se importava em curar.",
      "Estudante":""
  },
    ad:{
      "Cronista portugu√™s":"Gravura com repress√£o portuguesa ao levante dos Mal√™s.",
      "Ind√≠gena":"Vis√£o ind√≠gena da resist√™ncia negra na cidade de Salvador.",
      "Africano escravizado":"Imagem de africanos mu√ßulmanos escravizados vestidos de branco em rebeli√£o.",
      "Estudante":""
    }
  } 
  
};

// --- Elementos ---
const eventoSelect=document.getElementById('eventoSelect');
const narradorSelect=document.getElementById('narradorSelect');
const narrativeText=document.getElementById('narrativeText');
const eventImageContainer=document.getElementById('eventImageContainer');
const playAudioBtn=document.getElementById('playAudio');
const stopAudioBtn=document.getElementById('stopAudio');
const playADBtn=document.getElementById('playAD');
const compareBtn=document.getElementById('compareBtn');
const comparisonArea=document.getElementById('comparisonArea');
const resetViewBtn=document.getElementById('resetView');

// --- Elementos de grava√ß√£o ADICIONADOS ---
const recStartBtn = document.getElementById('recStart');
const recStopBtn = document.getElementById('recStop');
const recPlayBtn = document.getElementById('recPlay');
const recDeleteBtn = document.getElementById('recDelete');
const recordingStatus = document.getElementById('recordingStatus');

// --- Preencher eventos ---
Object.keys(data).forEach(ev=>{
  let opt=document.createElement('option'); opt.value=ev; opt.textContent=ev;
  eventoSelect.appendChild(opt);
});

// --- Preencher narradores ---
function populateNarrators(){
  narradorSelect.innerHTML='';
  if(eventoSelect.value && data[eventoSelect.value]){
    Object.keys(data[eventoSelect.value].narrativas).forEach(n=>{
      let o=document.createElement('option'); o.value=n; o.textContent=n;
      narradorSelect.appendChild(o);
    });
  }
}
eventoSelect.addEventListener('change', populateNarrators);
populateNarrators();

// --- Reset ---
resetViewBtn.addEventListener('click', ()=>{
  eventoSelect.selectedIndex=0;
  narradorSelect.innerHTML='';
  narrativeText.textContent='Selecione um evento e um narrador, depois clique em "Mostrar narrativa".';
  eventImageContainer.innerHTML='';
  playADBtn.disabled=true;
  comparisonArea.innerHTML='';
  updateRecordingStatus('');
});

// --- Mostrar narrativa (L√≥gica atualizada para nova imagem) ---
document.getElementById('showNarrative').addEventListener('click', ()=>{
  const ev=eventoSelect.value, nar=narradorSelect.value;
  if(ev && nar){
    // Se for Estudante e houver grava√ß√£o, mostra mensagem especial
    if (nar === "Estudante" && hasRecordingForCurrentEvent()) {
      narrativeText.textContent = "üé§ Narrativa em √°udio dispon√≠vel - clique em 'Reproduzir Grava√ß√£o' para ouvir.";
    } else {
      narrativeText.textContent = data[ev].narrativas[nar];
    }

    // L√≥gica para obter a imagem espec√≠fica da situa√ß√£o (Evento + Narrador)
    const eventImgSrc = eventImageMapping[ev] ? eventImageMapping[ev][nar] : '';
    let imageToShow = '';
    let altText = '';

    if(eventImgSrc){
      imageToShow = eventImgSrc;
      altText = `Imagem do evento ${ev} na perspectiva de ${nar}`;
    } else {
      // Fallback: se n√£o houver imagem para a situa√ß√£o, usa a imagem do perfil do narrador
      imageToShow = imageMapping[nar] || '';
      altText = `Imagem ilustrativa do narrador ${nar}`;
    }
    
    if (imageToShow) {
      eventImageContainer.innerHTML=`<img src="${imageToShow}" alt="${altText}">`;
    } else {
      eventImageContainer.innerHTML = '';
    }
    
    // Habilita o bot√£o de Audiodescri√ß√£o se houver texto AD
    playADBtn.disabled=!data[ev].ad[nar];
    playADBtn.onclick=()=>speakText(data[ev].ad[nar],"pt-BR");
    comparisonArea.innerHTML='';
  }
});

// --- Compara√ß√£o (L√≥gica atualizada para nova imagem) ---
compareBtn.addEventListener('click', ()=>{
  const ev=eventoSelect.value;
  if(!ev) return;
  const narrativas=data[ev].narrativas;
  const ads=data[ev].ad;
  comparisonArea.innerHTML="<h2>Compara√ß√£o de Narrativas</h2>";
  const container=document.createElement('div');
  container.className="compare-grid";
  
  Object.keys(narrativas).forEach(n=>{
    const div=document.createElement('div');
    div.className="card";
    
    // Busca a imagem espec√≠fica do evento/narrador (ou usa a imagem de perfil como fallback)
    const compareImgSrc = eventImageMapping[ev] && eventImageMapping[ev][n] ? eventImageMapping[ev][n] : imageMapping[n];
    const altText = `Imagem do evento ${ev} na perspectiva de ${n}`;

    let textoNarrativa = narrativas[n];
    // Se for Estudante e houver grava√ß√£o, mostra mensagem especial
    if (n === "Estudante" && hasRecordingForCurrentEvent()) {
      textoNarrativa = "üé§ Narrativa em √°udio (grava√ß√£o do estudante)";
    }

    div.innerHTML=`
      <h3>${n}</h3>
      <p>${textoNarrativa}</p>
      <img src="${compareImgSrc}" alt="${altText}">
      <button onclick='speakText(${JSON.stringify(textoNarrativa)},"pt-BR")'>‚ñ∂Ô∏è √Åudio</button>
      <button onclick='speakText(${JSON.stringify(ads[n])},"pt-BR")'>‚ôø Audiodescri√ß√£o</button>
    `;
    container.appendChild(div);
  });
  comparisonArea.appendChild(container);
});

// ------------------------------------------------------------------
// --- IMPLEMENTA√á√ÉO DE √ÅUDIO REVISADA ---
// ------------------------------------------------------------------

// --- TTS (Text-to-Speech) ---
let voices=[];
function loadVoices(){ voices=speechSynthesis.getVoices(); }
speechSynthesis.onvoiceschanged=loadVoices;
loadVoices();
function speakText(text,lang){
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);
  u.lang=lang;
  u.voice=voices.find(v=>v.lang===lang)||null;
  speechSynthesis.speak(u);
}

// Vari√°vel global para controlar o √°udio REAL que est√° sendo reproduzido
let currentAudio = null;

playAudioBtn.addEventListener('click', ()=>{
  const ev = eventoSelect.value;
  const nar = narradorSelect.value;
  
  // 1. Para o √°udio anterior, se estiver tocando
  if (currentAudio) {
    currentAudio.pause();
    currentAudio.currentTime = 0;
  }

  // Se for Estudante e houver grava√ß√£o, toca a grava√ß√£o
  if (nar === "Estudante" && hasRecordingForCurrentEvent()) {
    const recordingURL = getRecordingForCurrentEvent();
    currentAudio = new Audio(recordingURL);
    currentAudio.play().catch(error => {
      console.error("Erro ao reproduzir grava√ß√£o:", error);
      updateRecordingStatus("‚ùå Erro ao reproduzir grava√ß√£o");
    });
    return;
  }

  // 2. Tenta buscar o caminho do arquivo de √°udio real
  const audioPath = audioMapping[ev] ? audioMapping[ev][nar] : null;

  if (audioPath) {
    // 3. Se encontrar o caminho, tenta reproduzir o arquivo
    currentAudio = new Audio(audioPath);
    currentAudio.play()
        .then(() => {
            // Sucesso na reprodu√ß√£o
            console.log("√Åudio real reproduzido com sucesso:", audioPath);
        })
        .catch(error => {
            // 4. Fallback se a reprodu√ß√£o do arquivo real falhar (Ex: bloqueio do navegador, arquivo n√£o encontrado)
            console.error("Erro ao tentar reproduzir arquivo de √°udio. Usando TTS como fallback:", error);
            speakText(data[ev].narrativas[nar], "pt-BR");
        });
  } else if (ev && nar) {
    // 5. Se n√£o houver arquivo real mapeado, usa o TTS
    console.log("Caminho de √°udio n√£o mapeado, usando TTS.");
    speakText(data[ev].narrativas[nar], "pt-BR");
  }
});

stopAudioBtn.addEventListener('click', ()=>{
  speechSynthesis.cancel(); // Para o TTS
  if(currentAudio){
    currentAudio.pause();
    currentAudio.currentTime = 0;
  }
});

// ------------------------------------------------------------------
// --- SISTEMA DE GRAVA√á√ÉO CORRIGIDO ---
// ------------------------------------------------------------------

let mediaRecorder = null;
let audioChunks = [];
let audioStream = null;

// Fun√ß√£o para atualizar o status da grava√ß√£o
function updateRecordingStatus(message, type = '') {
  recordingStatus.textContent = message;
  recordingStatus.className = 'recording-status';
  if (type) {
    recordingStatus.classList.add(type);
  }
}

// Fun√ß√£o para verificar se h√° grava√ß√£o para o evento atual
function hasRecordingForCurrentEvent() {
  const eventKey = `recording_${eventoSelect.value.replace(/\s+/g, '_')}`;
  return localStorage.getItem(eventKey) !== null;
}

// Fun√ß√£o para obter a grava√ß√£o do evento atual
function getRecordingForCurrentEvent() {
  const eventKey = `recording_${eventoSelect.value.replace(/\s+/g, '_')}`;
  const savedRecording = localStorage.getItem(eventKey);
  if (savedRecording) {
    const uint8Array = new Uint8Array(JSON.parse(savedRecording));
    const blob = new Blob([uint8Array], { type: 'audio/webm' });
    return URL.createObjectURL(blob);
  }
  return null;
}

// Fun√ß√£o para salvar a grava√ß√£o no localStorage
function saveRecording(blob) {
  const reader = new FileReader();
  reader.onload = function() {
    const arrayBuffer = this.result;
    const uint8Array = new Uint8Array(arrayBuffer);
    
    // Salva no localStorage com chave √∫nica baseada no evento
    const eventKey = `recording_${eventoSelect.value.replace(/\s+/g, '_')}`;
    localStorage.setItem(eventKey, JSON.stringify(Array.from(uint8Array)));
    
    updateRecordingStatus('‚úÖ Grava√ß√£o salva com sucesso!', 'recording-saved');
    recPlayBtn.disabled = false;
    recDeleteBtn.disabled = false;
    
    // Atualiza a narrativa do Estudante para mostrar que h√° grava√ß√£o
    if (narradorSelect.value === "Estudante") {
      narrativeText.textContent = "üé§ Narrativa em √°udio dispon√≠vel - clique em 'Reproduzir Grava√ß√£o' para ouvir.";
    }
  };
  reader.readAsArrayBuffer(blob);
}

// Fun√ß√£o para excluir grava√ß√£o
function deleteRecording() {
  const eventKey = `recording_${eventoSelect.value.replace(/\s+/g, '_')}`;
  localStorage.removeItem(eventKey);
  
  updateRecordingStatus('Grava√ß√£o exclu√≠da');
  recPlayBtn.disabled = true;
  recDeleteBtn.disabled = true;
  
  // Restaura a narrativa original do Estudante
  if (narradorSelect.value === "Estudante") {
    narrativeText.textContent = data[eventoSelect.value].narrativas["Estudante"] || "";
  }
}

// Inicializar sistema de grava√ß√£o
async function initializeRecording() {
  try {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      throw new Error('Seu navegador n√£o suporta grava√ß√£o de √°udio');
    }

    // Verificar se h√° grava√ß√£o salva para o evento atual
    checkSavedRecording();

  } catch (error) {
    console.error('Erro ao inicializar grava√ß√£o:', error);
    recStartBtn.disabled = true;
    updateRecordingStatus('‚ùå Grava√ß√£o n√£o suportada neste navegador');
  }
}

// Verificar se h√° grava√ß√£o salva
function checkSavedRecording() {
  if (hasRecordingForCurrentEvent()) {
    recPlayBtn.disabled = false;
    recDeleteBtn.disabled = false;
    updateRecordingStatus('Grava√ß√£o dispon√≠vel para este evento');
  } else {
    updateRecordingStatus('Nenhuma grava√ß√£o salva para este evento');
  }
}

// Event Listeners para grava√ß√£o
recStartBtn.addEventListener('click', async () => {
  if (!eventoSelect.value) {
    updateRecordingStatus('‚ùå Selecione um evento primeiro');
    return;
  }

  try {
    // Obter acesso ao microfone
    audioStream = await navigator.mediaDevices.getUserMedia({ 
      audio: {
        echoCancellation: true,
        noiseSuppression: true,
        sampleRate: 44100
      } 
    });

    // Criar MediaRecorder
    mediaRecorder = new MediaRecorder(audioStream, {
      mimeType: 'audio/webm;codecs=opus'
    });

    audioChunks = [];

    mediaRecorder.ondataavailable = (event) => {
      if (event.data.size > 0) {
        audioChunks.push(event.data);
      }
    };

    mediaRecorder.onstop = () => {
      const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
      saveRecording(audioBlob);
      
      // Parar todas as tracks do stream
      if (audioStream) {
        audioStream.getTracks().forEach(track => track.stop());
        audioStream = null;
      }
    };

    mediaRecorder.onerror = (event) => {
      console.error('Erro na grava√ß√£o:', event.error);
      updateRecordingStatus('‚ùå Erro na grava√ß√£o');
    };

    // Iniciar grava√ß√£o
    mediaRecorder.start();
    recStartBtn.disabled = true;
    recStopBtn.disabled = false;
    recPlayBtn.disabled = true;
    updateRecordingStatus('üî¥ Gravando...', 'recording-active');

  } catch (error) {
    console.error('Erro ao acessar microfone:', error);
    updateRecordingStatus('‚ùå N√£o foi poss√≠vel acessar o microfone');
    recStartBtn.disabled = true;
  }
});

recStopBtn.addEventListener('click', () => {
  if (mediaRecorder && mediaRecorder.state === 'recording') {
    mediaRecorder.stop();
    recStartBtn.disabled = false;
    recStopBtn.disabled = true;
  }
});

recPlayBtn.addEventListener('click', () => {
  const recordingURL = getRecordingForCurrentEvent();
  if (recordingURL) {
    // Para qualquer √°udio que esteja tocando
    if (currentAudio) {
      currentAudio.pause();
      currentAudio.currentTime = 0;
    }
    speechSynthesis.cancel();
    
    // Toca a grava√ß√£o
    currentAudio = new Audio(recordingURL);
    currentAudio.play().catch(error => {
      console.error('Erro ao reproduzir √°udio:', error);
      updateRecordingStatus('‚ùå Erro ao reproduzir grava√ß√£o');
    });
  }
});

recDeleteBtn.addEventListener('click', deleteRecording);

// Verificar grava√ß√£o salva quando mudar o evento
eventoSelect.addEventListener('change', () => {
  checkSavedRecording();
});

// Inicializar o sistema de grava√ß√£o quando a p√°gina carregar
initializeRecording();
</script>
</body>
</html>
